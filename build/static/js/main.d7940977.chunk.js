(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{26:function(e,t,n){},28:function(e,t,n){e.exports=n.p+"static/media/music_8bit_jammer.d715561f.mp3"},29:function(e,t,n){e.exports=n(48)},42:function(e,t,n){},43:function(e,t,n){},44:function(e,t,n){},45:function(e,t,n){},46:function(e,t,n){},47:function(e,t,n){},48:function(e,t,n){"use strict";n.r(t);var r=n(5),a=n(0),o=n.n(a),i=n(19),c=n.n(i),l=n(3),u=n(2),s=n(14),f=n(4),d={boardSize:[10,20],blockSize:30,nextBlockSize:25,nextBlockBoardSize:4,gridColor1:"#5a338a",gridColor2:"#0e0032",baseFallRate:1,fallRateModifier:.5,outlineThickness:.14,boardSubstrateColor:"#FFF",boardSubstrateAlpha:.3,downMovementSpeed:40,holdKeyRepeatSpeed:20,startRepeatSpeed:2,beforeRepeatDelay:.25,controls:{rotate:["arrowup","keyw","space","mrotate"],left:["arrowleft","keya","mleft"],down:["arrowdown","keys","mdown"],right:["arrowright","keyd","mright"],start:["enter","mstart"]}},m=function(e){return{type:"GAME@SET_GAME_STATE",gameState:e}},h=function(e){return e.game.gameState},b=function(e){return e.game.nextBlock},v=function(e){return e.game.currentBlock},p=function(e){return e.game.board},E=function(e){var t=e.game;return d.baseFallRate+t.level*d.fallRateModifier},g="GAME_STATE_PLAYING",O="GAME_STATE_LOSE",S="GAME_STATE_PAUSE",k=function(e){return Object(u.times)(e,Object(u.constant)(0))},y=function(e){return e.length},w=function(e){return e[0].length};function _(e,t){return k(t).map(function(){return k(e)})}function T(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=y(t),o=w(t),i=y(e),c=y(e),l=0;l<a;l++)for(var s=0;s<o;s++)if(0!==t[l][s]){var f=s+n,d=l+r;if(!Object(u.inRange)(f,0,c)||!Object(u.inRange)(d,0,i))return!0;if(0!==e[d][f])return!0}return!1}function j(e,t,n,r){var a=w(t)+n-1,o=y(t)+r-1;return e.map(function(e,i){return e.map(function(e,c){return Object(u.inRange)(c,n,a+1)&&Object(u.inRange)(i,r,o+1)&&!e?t[i-r][c-n]:e})})}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(0===t)return e;for(var n=null,r=0;r<t;r++)n=R(e);return n}var A=function(e){return e.reduce(function(e,t,n){return t.every(function(e){return e>0})&&e.push(n),e},[])};function R(e){var t=y(e),n=w(e),r=_(t,n);return Object(u.times)(t,function(t){Object(u.times)(n,function(n){r[n][t]=e[t][n]})}),r.map(function(e){return e.reverse()})}var M={board:_.apply(void 0,Object(r.a)(d.boardSize)),gameState:S,score:0,highScore:0,level:0,isMusicPlaying:!0};var x=Object(s.b)({game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:M,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"BOARD@RESET_BOARD":return Object(f.a)({},e,{board:_.apply(void 0,Object(r.a)(d.boardSize))});case"GAME@SET_GAME_STATE":return Object(f.a)({},e,{gameState:t.gameState});case"GAME@SET_NEXT_BLOCK":return Object(f.a)({},e,{nextBlock:t.block});case"GAME@SET_CURRENT_BLOCK":return Object(f.a)({},e,{currentBlock:t.block});case"GAME@MOVE_BLOCK_DOWN":var n=Object(u.cloneDeep)(e.currentBlock);return n.y+=1,Object(f.a)({},e,{currentBlock:n});case"GAME@MOVE_BLOCK_LEFT":var a=e.currentBlock;if(T(e.board,a.matrix,a.x-1,a.y))return e;var o=Object(u.cloneDeep)(e.currentBlock);return o.x-=1,Object(f.a)({},e,{currentBlock:o});case"GAME@MOVE_BLOCK_RIGHT":var i=e.currentBlock;if(T(e.board,i.matrix,i.x+1,i.y))return e;var c=Object(u.cloneDeep)(e.currentBlock);return c.x+=1,Object(f.a)({},e,{currentBlock:c});case"GAME@ROTATE_BLOCK":var l=Object(u.cloneDeep)(e.currentBlock);return l.matrix=B(l.matrix),function(e,t){for(var n=w(e.matrix),r=1;T(t,e.matrix,e.x,e.y);)if(e.x+=r,r=r>0?-r:1-r,Math.abs(r)>Math.ceil(n/2))return!1;return!0}(l,e.board)?Object(f.a)({},e,{currentBlock:l}):e;case"GAME@MERGE_BLOCK_TO_BOARD":var s=t.block,m=s.matrix,h=s.x,b=s.y;return Object(f.a)({},e,{board:j(e.board,m,h,b)});case"GAME@REMOVE_LINES":return Object(f.a)({},e,{board:t.lineIndexes.reduce(function(e,t){return function(e,t){var n=Object(u.cloneDeep)(e),r=[k(w(n))];return n.splice(t,1),r.concat(n)}(e,t)},Object(u.cloneDeep)(e.board))});case"GAME@ADD_SCORE":var v=e.score+t.score,p=v>e.highScore?v:e.highScore,E=Math.floor(v/1e3);return Object(f.a)({},e,{score:v,highScore:p,level:E});case"GAME@RESET_SCORE":return Object(f.a)({},e,{score:0,level:0});default:return e}}}),N=Object(s.c)(x,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),z=0,C=function(e,t,n){var r=++z;return{name:e,id:r,colors:t,matrix:n.map(function(e){return e.map(function(e){return 0===e?0:r})}),x:0,y:0}},G=[C("I",{center:"#00f0f0",top:"#60f6f6",bottom:"#007b7b",left:"#31f3f3",right:"#00a7a7"},[[0,1,0],[0,1,0],[0,1,0],[0,1,0]]),C("J",{center:"#0000f0",top:"#6060f6",bottom:"#00007b",left:"#3131f3",right:"#0000a7"},[[0,1],[0,1],[1,1]]),C("L",{center:"#f0a000",top:"#f6c460",bottom:"#7b5200",left:"#f3b231",right:"#a76f00"},[[1,0],[1,0],[1,1]]),C("O",{center:"#f0f000",top:"#f6f660",bottom:"#7b7b00",left:"#f3f331",right:"#a7a700"},[[1,1],[1,1]]),C("S",{center:"#00f000",top:"#60f660",bottom:"#007b00",left:"#31f331",right:"#00a700"},[[0,1,1],[1,1,0]]),C("T",{center:"#a000f0",top:"#c460f6",bottom:"#52007b",left:"#b231f3",right:"#6f00a7"},[[0,1,0],[1,1,1]]),C("Z",{center:"#f00000",top:"#f66060",bottom:"#7b0000",left:"#f33131",right:"#a70000"},[[1,1,0],[0,1,1]])],D=n(24),L=n(15),P=n(8),I=n(17),K=n(9),F=n(10),q=n(12),U=n(11),V=n(6),W=n(13),X=n(20),H=n.n(X);function J(e,t,n,r){Y(e),function(e,t){var n=Object(I.a)(d.boardSize,2),r=n[0],a=n[1];e.globalAlpha=d.boardSubstrateAlpha,e.strokeStyle=d.boardSubstrateColor,e.lineWidth=1;for(var o=1;o<r;o++)e.beginPath(),e.moveTo(o*t,0),e.lineTo(o*t,a*t),e.stroke();for(var i=1;i<a;i++)e.beginPath(),e.moveTo(0,i*t),e.lineTo(a*t,i*t),e.stroke();e.globalAlpha=1}(e,r),function(e,t,n){Z(e,t,n)}(e,t,r),function(e,t,n){Z(e,t.matrix,n,t.x,t.y)}(e,n,r)}function Y(e){var t=e.canvas,n=t.width,r=t.height;e.fillStyle=d.gridColor2,e.fillRect(0,0,n,r)}function Z(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=y(t),i=w(t),c=0;c<o;c++)for(var l=0;l<i;l++){var u=t[c][l];0!==u&&$(e,l+r,c+a,u,n)}}function $(e,t,n,r,a){var o=function(e){return G.find(function(t){return t.id===e}).colors}(r),i=t*a,c=n*a,l=a*d.outlineThickness,u=2*l;!function(e,t,n,r,a,o){e.fillStyle=t,e.beginPath(),e.moveTo(n,r),e.lineTo(n+a,r),e.lineTo(n+a-o,r+o),e.lineTo(n+o,r+o),e.lineTo(n,r),e.fill()}(e,o.top,i,c,a,l),function(e,t,n,r,a,o){e.fillStyle=t,e.beginPath(),e.moveTo(n+a,r),e.lineTo(n+a,r+a),e.lineTo(n+a-o,r+a-o),e.lineTo(n+a-o,r+o),e.lineTo(n+a,r),e.fill()}(e,o.right,i,c,a,l),function(e,t,n,r,a,o){e.fillStyle=t,e.beginPath(),e.moveTo(n,r+a),e.lineTo(n+o,r+a-o),e.lineTo(n+a-o,r+a-o),e.lineTo(n+a,r+a),e.lineTo(n,r+a),e.fill()}(e,o.bottom,i,c,a,l),function(e,t,n,r,a,o){e.fillStyle=t,e.beginPath(),e.moveTo(n,r),e.lineTo(n,r+a),e.lineTo(n+o,r+a-o),e.lineTo(n+o,r+o),e.lineTo(n,r),e.fill()}(e,o.left,i,c,a,l),e.fillStyle=o.center,e.fillRect(i+l,c+l,a-u,a-u)}n(42);var Q=function(e){function t(e){var n;Object(K.a)(this,t),(n=Object(q.a)(this,Object(U.a)(t).call(this,e))).onResize=n.onResize.bind(Object(V.a)(n));var r=Object(I.a)(d.boardSize,2),a=r[0],o=r[1];return n.canvasPaddingBottom=100/a*o,n}return Object(W.a)(t,e),Object(F.a)(t,[{key:"componentDidMount",value:function(){this.ctx=this.canvas.getContext("2d"),this.draw()}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"tryInitialize",value:function(){this.isInitialized||(this.blockSize=this.calculateBlockSize(),this.isInitialized=!0)}},{key:"calculateBlockSize",value:function(){var e=Object(I.a)(d.boardSize,1)[0];return this.canvas.width/e}},{key:"onResize",value:function(){this.blockSize=this.calculateBlockSize(),this.draw()}},{key:"draw",value:function(){var e=this;this.frameAnimationRequest||(this.frameAnimationRequest=window.requestAnimationFrame(function(){var t=e.props,n=t.board,r=t.currentBlock;e.tryInitialize(),J(e.ctx,n,r,e.blockSize),e.frameAnimationRequest=void 0}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{style:{paddingBottom:"".concat(this.canvasPaddingBottom,"%")}},o.a.createElement(H.a,{canvasRef:function(t){return e.canvas=t},onResize:this.onResize,id:"game"}))}}]),t}(o.a.Component),ee=Object(l.b)(function(e){var t=e.game;return{board:t.board,currentBlock:t.currentBlock}})(Q),te=(n(43),function(e){function t(e){var n;return Object(K.a)(this,t),(n=Object(q.a)(this,Object(U.a)(t).call(this,e))).nextBlockBoardSize=d.nextBlockBoardSize,n.onResize=n.onResize.bind(Object(V.a)(n)),n}return Object(W.a)(t,e),Object(F.a)(t,[{key:"componentDidMount",value:function(){this.ctx=this.nextBlockCanvas.getContext("2d"),this.draw()}},{key:"componentDidUpdate",value:function(){this.draw()}},{key:"tryInitialize",value:function(){this.isInitialized||(this.blockSize=this.calculateBlockSize(),this.isInitialized=!0)}},{key:"onResize",value:function(){this.blockSize=this.calculateBlockSize(),this.draw()}},{key:"calculateBlockSize",value:function(){return this.nextBlockCanvas.width/this.nextBlockBoardSize}},{key:"draw",value:function(){var e=this;this.frameAnimationRequest||(this.frameAnimationRequest=window.requestAnimationFrame(function(){var t=e.props.nextBlock;e.tryInitialize(),Y(e.ctx);var n=Math.floor((e.nextBlockBoardSize-w(t.matrix))/2),r=Math.floor((e.nextBlockBoardSize-y(t.matrix))/2);Z(e.ctx,t.matrix,e.blockSize,n,r),e.frameAnimationRequest=void 0}))}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{className:"column"},o.a.createElement("span",{className:"column_title"},"Next"),o.a.createElement("div",{className:"container"},o.a.createElement("div",{className:"next_block_canvas_wrapper"},o.a.createElement(H.a,{canvasRef:function(t){return e.nextBlockCanvas=t},onResize:this.onResize,className:"next_block"}))))}}]),t}(o.a.Component)),ne=Object(l.b)(function(e){return{nextBlock:e.game.nextBlock}})(te),re=(n(44),Object(l.b)(function(e){var t=e.game;return{score:t.score,highScore:t.highScore}})(function(e){return o.a.createElement("div",{className:"column score_counter"},o.a.createElement("span",{className:"column_title"},"Score"),o.a.createElement("span",{className:"counter".concat(e.score>0&&e.score>=e.highScore?" rainbow":"")},e.score))})),ae=Object(l.b)(function(e){return{highScore:e.game.highScore}})(function(e){return o.a.createElement("div",{className:"column high_score_counter"},o.a.createElement("span",{className:"column_title high_score_title"},"High Score"),o.a.createElement("span",{className:"counter"},e.highScore))}),oe=Object(l.b)(function(e){return{level:e.game.level}})(function(e){return o.a.createElement("div",{className:"column level_counter"},o.a.createElement("span",{className:"column_title"},"Level"),o.a.createElement("span",{className:"counter"},e.level+1))}),ie=n(28),ce=n.n(ie),le=function(e){function t(){return Object(K.a)(this,t),Object(q.a)(this,Object(U.a)(t).apply(this,arguments))}return Object(W.a)(t,e),Object(F.a)(t,[{key:"componentDidMount",value:function(){this.refs.audio.volume=.5}},{key:"render",value:function(){return o.a.createElement("audio",{ref:"audio",src:ce.a,autoPlay:!0,loop:!0})}}]),t}(o.a.Component),ue=Object(l.b)(function(e){return{isPlaying:e.game.isMusicPlaying}})(le),se=n(16),fe={},de={add:function(e){fe[e.toLowerCase()]=!0},remove:function(e){delete fe[e.toLowerCase()]},reset:function(){fe={}},isPressed:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce(function(e,t){return e||void 0!==fe[t]},!1)}},me=(n(26),function(e){return o.a.createElement("button",{className:"btn-circle",onTouchStart:function(){return t=e.actionName,de.add(t);var t},onTouchEnd:function(){return t=e.actionName,de.remove(t);var t}},o.a.createElement(se.a,{className:"btn-icon",icon:e.icon}))}),he=(n(45),function(){return o.a.createElement("div",{className:"mobile-controls"},o.a.createElement(me,{icon:"chevron-left",actionName:"mleft"}),o.a.createElement(me,{icon:"chevron-right",actionName:"mright"}),o.a.createElement(me,{icon:"redo",actionName:"mrotate"}),o.a.createElement(me,{icon:"chevron-down",actionName:"mdown"}))}),be=(n(46),function(){return de.add("mstart")}),ve=function(){return de.remove("mstart")},pe=Object(l.b)(function(e){return{gameState:e.game.gameState}})(function(e){return o.a.createElement("button",{className:"btn-circle",onTouchStart:be,onTouchEnd:ve},e.gameState===g?o.a.createElement(se.a,{className:"btn-icon",icon:"pause"}):o.a.createElement(se.a,{className:"btn-icon",icon:"play"}))});L.b.add(P.e,P.d,P.f,P.c,P.b,P.a);var Ee=function(){return o.a.createElement("div",{className:"App"},o.a.createElement("div",{className:"main_container"},o.a.createElement("div",{className:"game_wrapper"},o.a.createElement(ee,null)),o.a.createElement("div",{className:"right_container"},o.a.createElement(ne,null),o.a.createElement(oe,null),o.a.createElement(re,null),o.a.createElement(ae,null),D.isMobile&&o.a.createElement("div",{className:"column"},o.a.createElement(pe,null)))),D.isMobile&&o.a.createElement(he,null),o.a.createElement(ue,null))},ge=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Oe(e){if("serviceWorker"in navigator){if(new URL("",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("","/service-worker.js");ge?(!function(e,t){fetch(e).then(function(n){var r=n.headers.get("content-type");404===n.status||null!=r&&-1===r.indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):Se(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")})):Se(t,e)})}}function Se(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}}).catch(function(e){console.error("Error during service worker registration:",e)})}n(47);var ke=0,ye=0,we=0,_e=0,Te=0,je=0,Be=0,Ae=0,Re=0,Me=0,xe=!1,Ne=!1,ze=!1,Ce=function(e){var t=e.code;de.add(t)},Ge=function(e){var t=e.code;de.remove(t)},De=function(){de.reset()};function Le(e){!function(e){var t=e-Te;if(Te=e,function(e){if(de.isPressed.apply(de,Object(r.a)(d.controls.start))){if(e-Me>ye)switch(Me=e,Xe()){case S:nt();break;case g:rt();break;case O:ot(),ut(),Fe(),nt()}}else Me=0}(e),Xe()!==g)return;(function(e){(function(e){de.isPressed.apply(de,Object(r.a)(d.controls.down))?e-Be>we&&(Be=e,je=0,$e()):Be=0})(e),function(e){if(de.isPressed.apply(de,Object(r.a)(d.controls.left))){var t=function(){Qe(),Ae=e},n=e-Ae;n>ke&&(0===Ae?t():(ze||n>_e)&&(ze=!0,t()))}else ze=!1,Ae=0}(e),function(e){if(de.isPressed.apply(de,Object(r.a)(d.controls.right))){var t=function(){et(),Re=e},n=e-Re;n>ke&&(0===Re?t():(Ne||n>_e)&&(Ne=!0,t()))}else Ne=!1,Re=0}(e),de.isPressed.apply(de,Object(r.a)(d.controls.rotate))?xe||(xe=!0,tt()):xe=!1})(e),function(e){(je+=e)>Math.ceil(1e3/Ze())&&(je=0,$e())}(t),Pe()&&(function(){var e=Object(u.cloneDeep)(Je());e.y-=1,it(e)}(),function(){var e=A(Ye());e.length>0&&(ct(e),lt(100*Math.pow(e.length,2)))}(),Ve(qe(He())),Ue(Ie()),Pe()&&at())}(e),window.requestAnimationFrame(Le)}var Pe=function(){var e=Je(),t=e.matrix,n=e.x,r=e.y;return T(Ye(),t,n,r)};function Ie(){var e=G[Ke(G.length)],t=Ke(4);return e.matrix=B(e.matrix,t),e}function Ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return Math.floor(Math.random()*(e-t)+t)}function Fe(){Ue(Ie()),Ve(qe(He())),Ue(Ie())}function qe(e){var t=Object(u.cloneDeep)(e);return t.x=Math.floor((d.boardSize[0]-t.matrix[0].length)/2),t}var Ue=function(e){return N.dispatch(function(e){return{type:"GAME@SET_NEXT_BLOCK",block:e}}(e))},Ve=function(e){return N.dispatch(function(e){return{type:"GAME@SET_CURRENT_BLOCK",block:e}}(e))},We=function(e){return e(N.getState())},Xe=function(){return We(h)},He=function(){return We(b)},Je=function(){return We(v)},Ye=function(){return We(p)},Ze=function(){return We(E)},$e=function(){return N.dispatch({type:"GAME@MOVE_BLOCK_DOWN"})},Qe=function(){return N.dispatch({type:"GAME@MOVE_BLOCK_LEFT"})},et=function(){return N.dispatch({type:"GAME@MOVE_BLOCK_RIGHT"})},tt=function(){return N.dispatch({type:"GAME@ROTATE_BLOCK"})},nt=function(){return N.dispatch(m(g))},rt=function(){return N.dispatch(m(S))},at=function(){return N.dispatch(m(O))},ot=function(){return N.dispatch({type:"BOARD@RESET_BOARD"})},it=function(e){return N.dispatch(function(e){return{type:"GAME@MERGE_BLOCK_TO_BOARD",block:e}}(e))},ct=function(e){return N.dispatch(function(e){return{type:"GAME@REMOVE_LINES",lineIndexes:e}}(e))},lt=function(e){return N.dispatch(function(e){return{type:"GAME@ADD_SCORE",score:e}}(e))},ut=function(){return N.dispatch({type:"GAME@RESET_SCORE"})};window.addEventListener("keydown",Ce),window.addEventListener("keyup",Ge),window.addEventListener("blur",De),ke=Math.ceil(1e3/d.holdKeyRepeatSpeed),ye=Math.ceil(1e3/d.startRepeatSpeed),we=Math.ceil(1e3/d.downMovementSpeed),_e=Math.ceil(1e3*d.beforeRepeatDelay),Fe(),c.a.render(o.a.createElement(l.a,{store:N},o.a.createElement(Ee,null)),document.getElementById("root")),Oe(),window.requestAnimationFrame(Le)}},[[29,1,2]]]);
//# sourceMappingURL=main.d7940977.chunk.js.map